<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ai-cli-complete-notify</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <div class="shell">
      <aside class="sidebar">
        <div class="brand">
          <div class="brandHeader">
            <div class="brandTitle" id="productName">ai-cli-complete-notify</div>
            <div class="brandVersion" id="productVersion"></div>
          </div>
          <div class="brandSub" data-i18n="brand.subtitle">多种 AI CLI 任务完成提醒</div>
          <div class="brandControls">
            <div class="sideToggle">
              <span data-i18n="ui.watchToggle">监听</span>
              <label class="switch" aria-label="watch toggle">
                <input id="watchToggle" type="checkbox" />
                <span class="slider"></span>
              </label>
            </div>
            <div class="sideSelect">
              <label for="languageSelect" data-i18n="ui.language">语言</label>
              <select id="languageSelect">
                <option value="zh-CN">中文</option>
                <option value="en">English</option>
              </select>
            </div>
          </div>
        </div>

        <nav class="nav">
          <a class="navItem" href="#channels" data-i18n="nav.channels">通道</a>
          <a class="navItem" href="#sound" data-i18n="nav.sound">提示音</a>
          <a class="navItem" href="#sources" data-i18n="nav.sources">来源</a>
          <a class="navItem" href="#watch" data-i18n="nav.watch">监听</a>
          <a class="navItem" href="#test" data-i18n="nav.test">测试</a>
          <a class="navItem" href="#summary" data-i18n="nav.summary">AI 摘要</a>
          <a class="navItem" href="#advanced" data-i18n="nav.advanced">高级</a>
        </nav>

        <div class="sideActions">
          <button id="githubBtn" class="ghost linkBtn" data-i18n-title="btn.projectLink" title="项目地址">
            <svg viewBox="0 0 16 16" aria-hidden="true">
              <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8a8 8 0 0 0 5.47 7.59c.4.07.55-.17.55-.38 0-.18-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82a7.5 7.5 0 0 1 4 0c1.53-1.03 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.45.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8Z"/>
            </svg>
            <span class="linkLabel" data-i18n="btn.projectLink">项目地址</span>
          </button>
          <button id="openDataDir" class="ghost withHint">
            <span data-i18n="btn.openDataDir">打开数据目录</span>
            <span class="hintIcon" data-i18n-title="hint.openDataDir" title="数据目录用于保存 settings.json、state.json 和 .env（可选）">?</span>
          </button>
          <button id="openConfigPath" class="ghost" data-i18n="btn.openSettings">打开 settings.json</button>
        </div>

        <div class="sideFooter">
          <div class="row">
            <button id="reloadBtn" class="ghost" data-i18n="btn.reload">刷新界面/配置</button>
          </div>
          <div class="hint" id="hint"></div>
        </div>
      </aside>

      <main class="content">
        <section class="panel" id="channels">
          <div class="panelHead">
            <div>
              <h2 data-i18n="section.channels.title">全局通道</h2>
              <div class="sub" data-i18n="section.channels.sub">全局开关 + 每来源开关同时生效</div>
            </div>
          </div>
          <div class="grid" id="globalChannels"></div>
        </section>

        <section class="panel" id="sound">
          <div class="panelHead">
            <div>
              <h2 data-i18n="section.sound.title">提示音</h2>
              <div class="sub" data-i18n="section.sound.sub">语音播报与提示音设置（支持自定义 .wav）</div>
            </div>
          </div>
          <div class="row">
            <label class="toggleRow">
              <input id="soundTtsEnabled" class="prettyCheck" type="checkbox" />
              <span data-i18n="advanced.soundTts">语音播报（TTS）</span>
            </label>
            <div class="hint" data-i18n="advanced.soundTtsHint">关闭后仅播放提示音。</div>
          </div>
          <div class="row" style="margin-top: 10px;">
            <label class="toggleRow">
              <input id="soundCustomEnabled" class="prettyCheck" type="checkbox" />
              <span data-i18n="advanced.soundCustom">使用自定义提示音</span>
            </label>
          </div>
          <div class="row isHidden" id="soundCustomRow" style="margin-top: 6px;">
            <label data-i18n="advanced.soundCustomPath">提示音文件路径</label>
            <input id="soundCustomPath" type="text" data-i18n-placeholder="advanced.soundCustomPlaceholder" placeholder="C:\path\to\sound.wav 或 /mnt/c/..." />
            <button id="soundOpenPathBtn" class="ghost" data-i18n="btn.soundOpenPath">打开文件</button>
          </div>
          <div class="hint isHidden" id="soundCustomHint" data-i18n="advanced.soundCustomHint">支持 .wav，可选择任意位置的文件 (WSL 请使用 Windows 路径或 /mnt/c/ 路径)。</div>
          <div class="hint" id="soundResolvedPath"></div>
          <div class="row" style="margin-top: 10px;">
            <button id="soundTestBtn" data-i18n="btn.soundTest">播放测试</button>
            <span id="soundTestStatus" class="inlineStatus" aria-live="polite"></span>
          </div>
        </section>

        <section class="panel" id="sources">
          <div class="panelHead">
            <div>
              <h2 data-i18n="section.sources.title">来源配置</h2>
              <div class="sub" data-i18n="section.sources.sub">按来源独立控制：启用、阈值、各通道开关</div>
            </div>
          </div>
          <div class="sources" id="sources"></div>
        </section>

        <section class="panel" id="watch">
          <div class="panelHead">
            <div>
              <h2 data-i18n="section.watch.title">交互式监听（watch）</h2>
              <div class="sub" data-i18n="section.watch.sub">适用于交互式不退出 / VSCode 插件：自动监听日志，在每次回复完成后提醒</div>
            </div>
            <div class="badge" id="watchStatus"></div>
          </div>

          <div class="watchGrid">
            <div class="watchCard watchLogCard">
              <div class="watchRow">
              <label class="chip"><input id="watchClaude" class="prettyCheck" type="checkbox" checked />Claude</label>
              <label class="chip"><input id="watchCodex" class="prettyCheck" type="checkbox" checked />Codex</label>
              <label class="chip"><input id="watchGemini" class="prettyCheck" type="checkbox" checked />Gemini</label>
              </div>
              <div class="watchRow">
                <label data-i18n="watch.polling">轮询(ms)</label>
                <div class="numberField">
                  <input id="watchIntervalMs" type="number" min="500" step="100" value="1000" />
                  <div class="numberStepper">
                    <button class="stepBtn" type="button" data-step="up" data-i18n-title="ui.stepUp" title="增加" aria-label="增加">
                      <svg viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                    <button class="stepBtn down" type="button" data-step="down" data-i18n-title="ui.stepDown" title="减少" aria-label="减少">
                      <svg viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
              <div class="watchRow">
                <div class="labelWithHint">
                  <label data-i18n="watch.claudeDebounce">Claude 去抖(ms)</label>
                  <span class="hintIcon" title="等待多久没有新消息后才发送提醒，避免在 Claude 还在执行任务时就提醒">?</span>
                </div>
                <div class="numberField">
                  <input id="watchClaudeQuietMs" type="number" min="1000" step="1000" value="60000" />
                  <div class="numberStepper">
                    <button class="stepBtn" type="button" data-step="up" data-i18n-title="ui.stepUp" title="增加" aria-label="增加">
                      <svg viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                    <button class="stepBtn down" type="button" data-step="down" data-i18n-title="ui.stepDown" title="减少" aria-label="减少">
                      <svg viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
              <div class="watchRow">
                <div class="labelWithHint">
                  <label data-i18n="watch.debounce">Gemini 去抖(ms)</label>
                  <span class="hintIcon" title="等待多久没有新消息后才发送提醒，避免在 Gemini 还在输出时就提醒">?</span>
                </div>
                <div class="numberField">
                  <input id="watchGeminiQuietMs" type="number" min="500" step="100" value="3000" />
                  <div class="numberStepper">
                    <button class="stepBtn" type="button" data-step="up" data-i18n-title="ui.stepUp" title="增加" aria-label="增加">
                      <svg viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                    <button class="stepBtn down" type="button" data-step="down" data-i18n-title="ui.stepDown" title="减少" aria-label="减少">
                      <svg viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
              <div class="watchRow">
                <div class="labelWithHint">
                  <label data-i18n="watch.logRetention">日志保留(天)</label>
                  <span class="hintIcon" data-i18n-title="watch.logRetentionHint" title="只保留最近 N 天的本地监听日志">?</span>
                </div>
                <div class="numberField">
                  <input id="watchLogRetentionDays" type="number" min="1" step="1" value="7" />
                  <div class="numberStepper">
                    <button class="stepBtn" type="button" data-step="up" data-i18n-title="ui.stepUp" title="增加" aria-label="增加">
                      <svg viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                    <button class="stepBtn down" type="button" data-step="down" data-i18n-title="ui.stepDown" title="减少" aria-label="减少">
                      <svg viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
              <div class="watchRow">
                <label class="toggleRow">
                  <input id="watchConfirmEnabled" class="prettyCheck" type="checkbox" />
                  <span data-i18n="watch.confirmEnabled">确认提醒</span>
                </label>
              </div>
              <div class="watchRow" id="watchConfirmKeywordsRow">
                <label data-i18n="watch.confirmKeywords">确认关键词（可选）</label>
                <span class="hintIcon" data-i18n-title="watch.confirmKeywordsHint" title="">?</span>
                <input
                  id="watchConfirmKeywords"
                  type="text"
                  data-i18n-placeholder="watch.confirmKeywordsPlaceholder"
                  placeholder="是否,确认,allow,approve"
                />
              </div>
              <div class="watchRow">
                <button id="watchStartBtn" data-i18n="btn.watchStart">开始监听</button>
                <button id="watchStopBtn" class="ghost" data-i18n="btn.watchStop">停止</button>
              </div>
              <div class="hint" data-i18n="watch.hint">建议把监听常驻开启（比如开机自启/放在后台终端），这样无论你在终端还是 VSCode 里用 Claude/Codex/Gemini，都能自动提醒。</div>
            </div>

            <div class="watchCard">
              <div class="watchLogHeadRow">
                <div class="watchLogHead" data-i18n="watch.logs">监听日志</div>
                <button id="openWatchLogBtn" class="ghost miniBtn" data-i18n="btn.openWatchLog">打开日志</button>
              </div>
              <pre class="log" id="watchLog"></pre>
            </div>
          </div>
        </section>

        <section class="panel" id="test">
          <div class="panelHead">
            <div>
              <h2 data-i18n="section.test.title">测试提醒</h2>
              <div class="sub" data-i18n="section.test.sub">用于验证通道是否可用（强制发送，不受阈值影响）</div>
            </div>
          </div>

          <div class="row">
            <label data-i18n="test.source">来源</label>
            <select id="testSource">
              <option value="claude">Claude</option>
              <option value="codex">Codex</option>
              <option value="gemini">Gemini</option>
            </select>
            <label data-i18n="test.duration">耗时(分钟)</label>
            <div class="numberField">
              <input id="testDuration" type="number" min="0" step="1" value="10" />
              <div class="numberStepper">
                <button class="stepBtn" type="button" data-step="up" data-i18n-title="ui.stepUp" title="增加" aria-label="增加">
                  <svg viewBox="0 0 16 16" aria-hidden="true">
                    <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                <button class="stepBtn down" type="button" data-step="down" data-i18n-title="ui.stepDown" title="减少" aria-label="减少">
                  <svg viewBox="0 0 16 16" aria-hidden="true">
                    <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </div>
            <label data-i18n="test.message">内容</label>
            <input id="testTask" type="text" value="测试提醒（强制发送）" />
            <button id="testBtn" data-i18n="btn.send">发送</button>
          </div>
          <pre class="log" id="log"></pre>
        </section>

        <section class="panel" id="summary">
          <div class="panelHead">
            <div>
              <h2 data-i18n="section.summary.title">AI 摘要</h2>
              <div class="sub" data-i18n="section.summary.sub">用于生成通知中的简短摘要，未在超时内返回则使用原始任务描述。</div>
            </div>
          </div>
          <div class="row summaryHeadRow">
            <div class="toggleRow">
              <label for="summaryEnabled" data-i18n="summary.enabled">启用 AI 摘要</label>
              <label class="switch" aria-label="summary toggle">
              <input id="summaryEnabled" class="prettyCheck" type="checkbox" />
                <span class="slider"></span>
              </label>
            </div>
            <div class="summaryProvider">
              <label for="summaryProvider" data-i18n="summary.provider">模型平台</label>
              <select id="summaryProvider">
                <option value="openai" data-i18n="summary.provider.openai">OpenAI</option>
                <option value="anthropic" data-i18n="summary.provider.anthropic">Anthropic</option>
                <option value="google" data-i18n="summary.provider.google">Google / Gemini</option>
                <option value="qwen" data-i18n="summary.provider.qwen">通义千问</option>
                <option value="deepseek" data-i18n="summary.provider.deepseek">DeepSeek</option>
              </select>
            </div>
          </div>
          <div id="summaryFields" class="summaryFields isCollapsed">
            <div class="row">
              <label data-i18n="summary.apiUrl">API URL</label>
              <input id="summaryApiUrl" type="text" placeholder="https://open.bigmodel.cn/api/paas/v4/chat/completions" />
            </div>
            <div id="summaryApiUrlExample" class="hint"></div>
            <div class="row">
              <label data-i18n="summary.apiKey">API Key</label>
              <div class="inputWithAction">
                <input id="summaryApiKey" type="password" placeholder="your_api_key" />
                <button id="summaryApiKeyToggle" class="ghost inputActionBtn" type="button" data-i18n-title="summary.apiKeyToggle.show" title="显示 API Key" aria-label="显示 API Key">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M2 12c2.6-4.2 5.8-6.3 10-6.3s7.4 2.1 10 6.3c-2.6 4.2-5.8 6.3-10 6.3S4.6 16.2 2 12Z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
                    <circle cx="12" cy="12" r="3.2" fill="none" stroke="currentColor" stroke-width="1.6"/>
                    <path class="eyeSlash" d="M4 4L20 20" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="row">
              <label data-i18n="summary.model">模型</label>
              <input id="summaryModel" type="text" placeholder="glm-4-flash-250414" />
            </div>
            <div class="row">
              <div class="labelWithHint">
                <label data-i18n="summary.timeout">超时(ms)</label>
                <span class="hintIcon" data-i18n-title="summary.timeoutHint" title="超过时限会自动回退到默认任务描述">?</span>
              </div>
              <div class="numberField">
                <input id="summaryTimeoutMs" type="number" min="300" step="100" value="15000" />
                <div class="numberStepper">
                  <button class="stepBtn" type="button" data-step="up" data-i18n-title="ui.stepUp" title="增加" aria-label="增加">
                    <svg viewBox="0 0 16 16" aria-hidden="true">
                      <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                  <button class="stepBtn down" type="button" data-step="down" data-i18n-title="ui.stepDown" title="减少" aria-label="减少">
                    <svg viewBox="0 0 16 16" aria-hidden="true">
                      <path d="M4.5 9.5 8 6l3.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
            <div class="row">
              <label data-i18n="summary.test">摘要测试</label>
              <div class="summaryTestControls">
                <button id="summaryTestBtn" class="ghost" type="button" data-i18n="summary.testBtn">开始测试</button>
                <div id="summaryTestResult" class="hint"></div>
              </div>
            </div>
            <div class="hint" data-i18n="summary.hint">填写 API 信息后即可生效，未返回摘要时会自动回退。</div>
          </div>
        </section>

        <section class="panel" id="advanced">
          <div class="panelHead">
            <div>
              <h2 data-i18n="section.advanced.title">高级</h2>
              <div class="sub" data-i18n="section.advanced.sub">格式化与展示相关配置</div>
            </div>
          </div>
          <div class="row" style="margin-top: 10px;">
            <label class="toggleRow">
              <input id="useFeishuCard" class="prettyCheck" type="checkbox" />
              <span data-i18n="advanced.useFeishuCard">Webhook 使用飞书卡片格式</span>
            </label>
          </div>
          <div class="row" style="margin-top: 10px;">
            <label data-i18n="advanced.closeBehavior">关闭按钮行为</label>
            <select id="closeBehavior">
              <option value="ask" data-i18n="close.ask">每次询问</option>
              <option value="tray" data-i18n="close.tray">隐藏到托盘</option>
              <option value="exit" data-i18n="close.exit">直接退出</option>
            </select>
          </div>
          <div class="row" style="margin-top: 10px;">
            <label class="toggleRow">
              <input id="autoFocusOnNotify" class="prettyCheck" type="checkbox" />
              <span data-i18n="advanced.autoFocus">点击通知切回工作界面</span>
            </label>
          </div>
          <div class="row isHidden" id="focusTargetRow" style="margin-top: 10px;">
            <label data-i18n="advanced.focusTarget">切回目标</label>
            <select id="focusTarget">
              <option value="auto" data-i18n="focus.auto">自动判断</option>
              <option value="vscode" data-i18n="focus.vscode">VSCode</option>
              <option value="terminal" data-i18n="focus.terminal">命令行/终端</option>
            </select>
          </div>
          <div class="hint isHidden" id="focusHint" data-i18n="advanced.focusHint">点击桌面通知后尝试切回（更可靠）。系统焦点限制可能仍阻止抢占前台；VSCode 插件场景建议选 VSCode 目标。</div>
          <div class="row isHidden" id="forceMaximizeRow" style="margin-top: 10px;">
            <label class="toggleRow">
              <input id="forceMaximizeOnFocus" class="prettyCheck" type="checkbox" />
              <span data-i18n="advanced.forceMaximize">切回时强制最大化（WSL / 终端也生效）</span>
            </label>
            <div class="hint" data-i18n="advanced.forceMaximizeHint">任务执行中最小化后，点击通知会恢复为最大化窗口。</div>
          </div>
          <div class="row" style="margin-top: 10px;">
            <label class="toggleRow">
              <input id="autostart" class="prettyCheck" type="checkbox" />
              <span data-i18n="advanced.autostart">开机自启动（登录后自动在后台运行）</span>
            </label>
            <div class="hint" data-i18n="advanced.autostartHint">Windows / macOS 支持开机自启动；Linux 需自行配置。</div>
            <div class="hint" id="autostartStatus" data-i18n="advanced.autostartStatusUnknown">系统自启动：未知</div>
          </div>
          <div class="row" style="margin-top: 10px;">
            <label class="toggleRow">
              <input id="silentStart" class="prettyCheck" type="checkbox" />
              <span data-i18n="advanced.silentStart">Silent start (hide to tray on launch)</span>
            </label>
          </div>
          <div class="hint" data-i18n="advanced.silentStartHint">Takes effect next launch and skips the tray balloon.</div>
          <div class="hint" data-i18n="advanced.closeHint">选择“隐藏到托盘”后，点击右上角关闭不会退出，会在右下角托盘保留图标，点击即可重新打开。</div>
        </section>
      </main>
    </div>

    <div id="closeModal" class="modalMask" aria-hidden="true">
      <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="closeModalTitle">
        <div class="modalTitle" id="closeModalTitle" data-i18n="close.message">关闭应用？</div>
        <div class="modalSub" data-i18n="close.detail">可选择隐藏到托盘继续运行，或直接退出并停止监听。</div>
        <div class="modalActions">
          <button id="closeHideBtn" data-i18n="close.hide">隐藏到托盘</button>
          <button id="closeQuitBtn" class="ghost" data-i18n="close.quit">退出</button>
          <button id="closeCancelBtn" class="ghost" data-i18n="close.cancel">取消</button>
        </div>
        <label class="toggleRow modalRemember">
          <input id="closeRemember" class="prettyCheck" type="checkbox" />
          <span data-i18n="close.remember">记住我的选择（可在“高级”里修改）</span>
        </label>
      </div>
    </div>

    <script src="./renderer.js"></script>
  </body>
</html>
